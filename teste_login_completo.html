<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Todos os Logins - Mr. Carlos Barbershop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8">Teste de Todos os Sistemas de Login</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <!-- Login Cliente -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-bold mb-4 text-blue-600">üßë‚Äçüíº Login Cliente</h2>
                <form id="clienteForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Email:</label>
                        <input type="email" name="email" value="joao.cliente@teste.com" 
                               class="w-full p-2 border rounded" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Password:</label>
                        <input type="password" name="password" value="cliente123" 
                               class="w-full p-2 border rounded" required>
                    </div>
                    <button type="button" onclick="testarLogin('cliente')" 
                            class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">
                        Testar Login Cliente
                    </button>
                </form>
                <div id="resultado-cliente" class="mt-4 p-3 rounded hidden"></div>
            </div>

            <!-- Login Barbeiro -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-bold mb-4 text-green-600">‚úÇÔ∏è Login Barbeiro</h2>
                <form id="barbeiroForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Email:</label>
                        <input type="email" name="email" value="carlos.barbeiro@teste.com" 
                               class="w-full p-2 border rounded" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Password:</label>
                        <input type="password" name="password" value="barbeiro123" 
                               class="w-full p-2 border rounded" required>
                    </div>
                    <button type="button" onclick="testarLogin('barbeiro')" 
                            class="w-full bg-green-600 text-white p-2 rounded hover:bg-green-700">
                        Testar Login Barbeiro
                    </button>
                </form>
                <div id="resultado-barbeiro" class="mt-4 p-3 rounded hidden"></div>
            </div>

            <!-- Login Admin -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-bold mb-4 text-purple-600">üëë Login Admin</h2>
                <form id="adminForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Email:</label>
                        <input type="email" name="email" value="admin@teste.com" 
                               class="w-full p-2 border rounded" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Senha:</label>
                        <input type="password" name="senha" value="admin123" 
                               class="w-full p-2 border rounded" required>
                    </div>
                    <button type="button" onclick="testarLogin('admin')" 
                            class="w-full bg-purple-600 text-white p-2 rounded hover:bg-purple-700">
                        Testar Login Admin
                    </button>
                </form>
                <div id="resultado-admin" class="mt-4 p-3 rounded hidden"></div>
            </div>
        </div>

        <div class="mt-8 bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-xl font-bold mb-4">üß™ Teste Autom√°tico de Todos</h2>
            <button onclick="testarTodos()" 
                    class="bg-gray-800 text-white px-6 py-3 rounded hover:bg-gray-700">
                Executar Teste Completo
            </button>
            <div id="resultado-geral" class="mt-4"></div>
        </div>
    </div>

    <script>
        async function testarLogin(tipo) {
            const form = document.getElementById(tipo + 'Form');
            const resultado = document.getElementById('resultado-' + tipo);
            
            let url;
            switch(tipo) {
                case 'cliente':
                    url = '/mr-carlos-barbershop/pages/login.php';
                    break;
                case 'barbeiro':
                    url = '/mr-carlos-barbershop/barbeiro/login.php';
                    break;
                case 'admin':
                    url = '/mr-carlos-barbershop/admin/login.php';
                    break;
            }
            
            resultado.className = 'mt-4 p-3 rounded bg-blue-50 border border-blue-200';
            resultado.innerHTML = '<div class="info">üîÑ Carregando p√°gina para obter token CSRF...</div>';
            resultado.classList.remove('hidden');
            
            try {
                // Primeiro, carregar a p√°gina para obter o token CSRF
                const getResponse = await fetch(url);
                const pageHtml = await getResponse.text();
                
                // Extrair token CSRF do HTML
                const csrfMatch = pageHtml.match(/name="csrf_token"[^>]*value="([^"]+)"/);
                const csrfToken = csrfMatch ? csrfMatch[1] : '';
                
                if (!csrfToken) {
                    throw new Error('Token CSRF n√£o encontrado na p√°gina');
                }
                
                // Preparar dados do formul√°rio
                const formData = new FormData(form);
                formData.append('csrf_token', csrfToken);
            
            resultado.className = 'mt-4 p-3 rounded bg-blue-50 border border-blue-200';
            resultado.innerHTML = '<div class="info">üîÑ Testando login...</div>';
            resultado.classList.remove('hidden');
            
            fetch(url, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.redirected) {
                    resultado.className = 'mt-4 p-3 rounded bg-green-50 border border-green-200';
                    resultado.innerHTML = '<div class="success">‚úÖ LOGIN BEM-SUCEDIDO!<br>Redirecionado para: ' + response.url + '</div>';
                } else if (response.ok) {
                    return response.text();
                } else {
                    throw new Error('Erro HTTP: ' + response.status);
                }
            })
            .then(text => {
                if (text) {
                    if (text.includes('incorretos') || text.includes('erro')) {
                        resultado.className = 'mt-4 p-3 rounded bg-red-50 border border-red-200';
                        resultado.innerHTML = '<div class="error">‚ùå FALHA: Credenciais incorretas ou erro no login</div>';
                    } else {
                        resultado.className = 'mt-4 p-3 rounded bg-yellow-50 border border-yellow-200';
                        resultado.innerHTML = '<div class="info">‚ö†Ô∏è Resposta recebida mas sem redirecionamento</div>';
                    }
                }
            })
            .catch(error => {
                resultado.className = 'mt-4 p-3 rounded bg-red-50 border border-red-200';
                resultado.innerHTML = '<div class="error">‚ùå ERRO: ' + error.message + '</div>';
            });
        }
        
        function testarTodos() {
            const resultado = document.getElementById('resultado-geral');
            resultado.innerHTML = '<div class="info">üîÑ Executando teste completo...</div>';
            
            setTimeout(() => testarLogin('cliente'), 500);
            setTimeout(() => testarLogin('barbeiro'), 1000);
            setTimeout(() => testarLogin('admin'), 1500);
            
            setTimeout(() => {
                resultado.innerHTML = '<div class="success">‚úÖ Teste completo executado! Verifique os resultados individuais acima.</div>';
            }, 2000);
        }
    </script>
</body>
</html>